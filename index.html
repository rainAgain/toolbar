<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="css/left.css">
</head>
<body>
	<div class="header">
		<div class="menu" id="menu">
			菜单
		</div>
		<div class="left-bar" id="left-bar">
			<div class="left-bar-box bar-item" data-level='0' >
				<ul>
				    <li class="common-item" data-num="0">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="1">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="2">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="3">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="4">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="5">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				    <li class="common-item" data-num="6">
				    	弹性计算
				    	<i class="icon-arrow-right"></i>
				    </li>
				</ul>
			</div>
			<div class="left-bar-extend bar-item extend-leve1" data-level='1' id="extend-leve1">
				<ul class="left-bar-content">
				    <li class="common-item" data-num="0">第二级1</li>
				    <li class="common-item" data-num="1">第二级1</li>
				    <li class="common-item" data-num="2">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				    <li class="common-item" data-num="3">第二级1</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				    <li class="common-item">第二级2</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				    <li class="common-item">333333</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				    <li class="common-item">4444444444</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				    <li class="common-item">55555</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				    <li class="common-item">666666666666</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				    <li class="common-item">777777777</li>
				</ul>
			</div>
			<div class="left-bar-extend bar-item extend-leve2" data-level='2' id="extend-leve2">
				<ul class="left-bar-content">
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="1">第三季1集</li>
				    <li class="common-item" data-num="2">第三季1集</li>
				    <li class="common-item" data-num="3">第三季1集</li>
				    <li class="common-item" data-num="4">第三季1集</li>
				    <li class="common-item" data-num="5">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				    <li class="common-item" data-num="0">第三季1集</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item" data-num="1">第三季2集</li>
				    <li class="common-item">第三季2集</li>
				    <li class="common-item">第三季2集</li>
				    <li class="common-item">第三季2集</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item" data-num="2">第三季3集</li>
				    <li class="common-item">第三季3集</li>
				    <li class="common-item">第三季3集</li>
				    <li class="common-item">第三季3集</li>
				</ul>
			</div>
			<div class="left-bar-extend bar-item extend-leve3" data-level='3' id="extend-leve3">
				<ul class="left-bar-content">
				    <li class="common-item">第四季1</li>
				    <li class="common-item">第四季1</li>
				    <li class="common-item">第四季1</li>
				    <li class="common-item">第四季1</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">第四季2</li>
				    <li class="common-item">第四季2</li>
				    <li class="common-item">第四季2</li>
				    <li class="common-item">第四季2</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">第四季3</li>
				    <li class="common-item">第四季3</li>
				    <li class="common-item">第四季3</li>
				    <li class="common-item">第四季3</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">第四季4</li>
				    <li class="common-item">第四季4</li>
				    <li class="common-item">第四季4</li>
				    <li class="common-item">第四季4</li>
				</ul>
				<ul class="left-bar-content">
				    <li class="common-item">第四季5</li>
				    <li class="common-item">第四季5</li>
				    <li class="common-item">第四季5</li>
				    <li class="common-item">第四季5</li>
				</ul>
			</div>
		</div>
	</div>
	
	<script src="js/jquery.js"></script>
	<script src="js/mustache.min.js"></script>
	<script src="js/data2.js"></script>
	<script>
		//处理数据
		(function() {

			var max = 0;
			var getRowKey = function(rowkey, i) {
	            return (rowkey === undefined) ? (i + '') : (rowkey + '-' + i);
	        };
	        console.time('calc');
			var calcLength = function(list, rowkey) {
				var listArr = [];

				list.forEach(function(item, index) {

					item.hasChild = !!(item.items && item.items.length);

					item.rowkey = getRowKey(rowkey, index);

					var rowkeyLength = item.rowkey.split('-').length;
					
					if(rowkeyLength > max) {
						max = rowkeyLength;
					}

	                if (item.hasChild) {
	                	calcLength(item.items, item.rowkey);
	                }

				});
			};

			calcLength(list);
			console.timeEnd('calc');
			console.log(max);

			var itemArr = [];
			var num = 0;
			var dataArr = [];

			console.time('handle');
			var handleData = function(list) {

				var tempArr = [];

				if(num == 0 ) {
					var firstArr = [];

					for(var i = 0,len = list.length; i< len; i++) {
						list[i].id = "w_" + i;
						firstArr.push(list[i]);
					}
					
					tempArr.push({
						pid:'',
						data: firstArr
					});
				} else if(num < max) {

					for(var i = 0, len = list.length; i < len; i++) {

						for(var m = 0,mlen = list[i].data.length; m < mlen;m++) {
							if(list[i].data[m].items) {

								list[i].data[m].items.forEach(function(item, index) {
									item.id = list[i].data[m].id + '_c_' +index;
								});

								tempArr.push({
									pid: list[i].data[m].id,
									data: list[i].data[m].items
								});
							}
						}
						
					}
				} else {
					return;
				}

				num  = num + 1;
				dataArr.push({
					level: num -1,
					tab:tempArr
				});

				
				handleData(tempArr);
			};

			handleData(list);
			
			console.timeEnd('handle');

			//console.log(dataArr);

			var $leftBar = $('#left-bar');

			var LIST_TPL = '{{#list}}<div class="{{^level}}left-bar-first{{/level}} {{#level}}left-bar-extend{{/level}} bar-item extend-leve{{level}}" data-level="{{level}}" >{{#tab}}<ul class="{{#level}}left-bar-content{{/level}} {{pid}}">{{#data}} <li class="common-item" data-num="0" data-ref="{{id}}" data-name="{{name}}" data-code="{{code}}" data-haschild="{{hasChild}}" data-opentype="{{openType}}" data-url="{{url}}">{{name}}{{#hasChild}}<i class="icon-arrow-right"></i>{{/hasChild}}</li>{{/data}}</ul>{{/tab}}</div>{{/list}}';
			
			Mustache.parse(LIST_TPL);
			var listStr = Mustache.render(LIST_TPL,{list:dataArr});
			
			$leftBar.html(listStr);
		})();
	</script>
	<script src="js/toolbar.js"></script>
	<script>
		$.ToolBar({
			menu: '.menu',
			menuEvent: 'mouseover',
			hiddenAll:function(){
				console.log('hiddenAll');
			},
			hidden:function(dom){
				//console.log($(dom).data('level'));
			}
		});
	</script>
</body>
</html>